<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Administration des sorties de stocks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/admin.css">
  <script src="https://cdn.jsdelivr.net/npm/pouchdb@7.3.1/dist/pouchdb.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>
  <header>
    <div class="header-content">
      <h1>üì¶ Administration des Sorties des stocks</h1>
      <div class="user-info">
        <span id="currentUserLabel"></span>
        <button class="logout-btn" id="logoutBtn">
          D√©connexion
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main>
    <div class="admin-controls">
      <button id="exportBtn">Exporter en CSV</button>
      <button id="exportToDriveBtn" class="btn-primary">Envoi par mail des produits aux achats</button>
      <button id="exportXlsxBobinesBtn" class="btn-primary" style="display:none">Envoi par mail des bobines aux achats</button>
      <button id="syncBtn">Synchroniser avec le serveur</button>
      <button id="deleteSelectedBtn" class="danger">Supprimer la s√©lection</button>
      <button id="deleteAllBtn" class="danger">Tout supprimer</button>
      <button id="resetFiltersBtn">R√©initialiser les filtres</button>
    </div>
      <div id="currentServiceDisplay" class="current-service-display">
        Service actuel: <strong id="currentServiceLabel">Chargement...</strong>
      </div>

    <div class="search-filter-container">
      <div class="filter-container">
        <div class="floating-filter">
          <input 
            type="text" 
            id="searchInput" 
            class="filter-input"
            placeholder=" "
          >
          <label for="searchInput" class="filter-label">Rechercher...</label>
          <span class="filter-icon">üîç</span>
        </div>
      </div>
      
      <div class="filter-container">
        <div class="floating-filter">
          <input 
            type="date"
            id="dateFilter"
            class="filter-input"
            placeholder=" "
            data-placeholder="Toutes les dates"
          >
          <label for="dateFilter" class="filter-label">Date de sortie</label>
          <span class="filter-icon">üìÖ</span>
        </div>
      </div>
      <div class="filter-container">
         <div class="floating-filter">
  <select id="filterSelect" class="form-control" disabled>
    <option value="" selected></option>
    <option value="SCT=E260329">SCE Informations Sportives</option>
    <option value="SCT=E272329">SCE Support R√©daction</option>
    <option value="SCT=E370329">Maintenance Machines</option>
    <option value="SCT=E382329">Service Rotatives</option>
    <option value="SCT=E390329">Service Exp√©dition</option>
    <option value="SCT=E500329">Direction Vente</option>
    <option value="SCT=E730329">LER Charges</option>
    <option value="SCT=E736329">Service Travaux</option>
    <option value="SCT=E760329">Achats Magasin</option>
    <option value="SCT=E762329">Manutention Papier</option>
    <option value="SCT=E772329">Coursiers</option>
    <option value="SCT=E860329">Cantine</option>
    <option value="SCT=E359329">SMI</option>
    <option value="Admin">Compte Admin</option>
    <option value="BOB329">Bobines</option>
  </select>
  <label for="filterSelect" class="filter-label">Compte</label>
  <span class="filter-icon">‚ñº</span>
</div>
</div>

      <div class="filter-container">
        <div class="floating-filter">
          <select id="commandeFilter" class="filter-input">
            <option value="" selected>Toutes</option>
            <option value="oui">Oui</option>
            <option value="non">Non</option>
          </select>
          <label for="commandeFilter" class="filter-label">√Ä commander</label>
          <span class="filter-icon">‚ñº</span>
        </div>
      </div>

      <div class="filter-container">
        <div class="floating-filter">
          <select id="magasinFilter" class="filter-input">
            <option value="" selected>Tous</option>
            <option value="ER-MG">ER-MG</option>
            <option value="ER-MP">ER-MP</option>
          </select>
          <label for="magasinFilter" class="filter-label">Magasin</label>
          <span class="filter-icon">‚ñº</span>
        </div>
      </div>
    </div>
    
<div class="stats-container">
  <!-- Carte 1 : Total -->
  <div class="stat-card" data-tooltip="Total des enregistrements du service">
    <span class="stat-value" id="totalCount">0</span>
    <span class="stat-label">Total</span>
    <div class="stat-trend" id="trendTotal"></div>
  </div>

  <!-- Carte 2 : 7 derniers jours -->
  <div class="stat-card" data-tooltip="Enregistrements des 7 derniers jours">
    <span class="stat-value" id="last7DaysCount">0</span>
    <span class="stat-label">7 derniers jours</span>
    <div class="stat-trend" id="trend7Days"></div>
  </div>

  <!-- Carte 3 : √Ä commander -->
  <div class="stat-card" data-tooltip="Articles marqu√©s '√Ä commander'">
    <span class="stat-value" id="toOrderCount">0</span>
    <span class="stat-label">√Ä commander</span>
    <div class="stat-badge" id="urgentOrders"></div>
  </div>

  <!-- Carte 4 : Par magasin (ER-MP/ER-MG) -->
  <div class="stat-card" data-tooltip="R√©partition par magasin">
    <div class="stat-magasin">
      <span class="magasin-value" id="magasinMP">0</span>
      <span class="magasin-label">ER-MP</span>
      <span class="magasin-value" id="magasinMG">0</span>
      <span class="magasin-label">ER-MG</span>
    </div>
    <span class="stat-label">R√©partition magasin</span>
  </div>
</div>

    <div class="table-responsive">
      <table id="dataTable">
        <thead>
          <tr>
            <th width="40px"><input type="checkbox" id="selectAll"></th>
            <th width="120px">Date de sortie</th>
            <th width="120px">Code Produit</th>
            <th width="250px">D√©signation</th> 
            <th width="80px">Quantit√©</th>
            <th width="80px">Unit√©s</th>
            <th width="100px">√Ä Commander</th>
            <th width="120px">Magasin</th>
            <th width="150px">Axe 1</th>
            <th width="150px">Axe 2</th>
            <th width="70px">Photos</th>
            <th width="150px">Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="pagination-container">
      <div class="pagination-info" id="paginationInfo"></div>
      <div class="pagination-controls">
        <button id="firstPageBtn">‚èÆÔ∏è Premi√®re</button>
        <button id="prevPageBtn">‚óÄÔ∏è Pr√©c√©dente</button>
        <div class="page-numbers" id="pageNumbers"></div>
        <button id="nextPageBtn">Suivante ‚ñ∂Ô∏è</button>
        <button id="lastPageBtn">Derni√®re ‚è≠Ô∏è</button>
      </div>
    </div>
  </main>

  <footer>
    <p>&copy; üì¶ 2025 - Gestion des sorties de Stocks</p>
  </footer>

  <!-- Inputs fichier cach√©s pour le modal d'√©dition -->
  <input type="file" id="cameraInputModal" accept="image/*" capture="environment" style="display:none;">
  <input type="file" id="galleryInputModal" accept="image/*" multiple style="display:none;">

  <script src="js/admin.js"></script>
</body>
</html>
